!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("./pre-dem-wxapp-conf.js"));else if("function"==typeof define&&define.amd)define(["./pre-dem-wxapp-conf.js"],t);else{var r="object"==typeof exports?t(require("./pre-dem-wxapp-conf.js")):t(e["./pre-dem-wxapp-conf.js"]);for(var o in r)("object"==typeof exports?exports:e)[o]=r[o]}}(window,function(e){return function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){const o=r(1);var n,a,s,i,c,p=!1,d=!1,u=!1,m=!1,l=!1,_=!1;const g="_origin_",f=()=>{S(),b(),D(),O(),k(),setTimeout(f,1e4)},x=e=>{var t=J();t.type="auto_captured",t.name="monitor",e&&(t.content=JSON.stringify(e)),w("predem_http_event",t)},v=e=>{var t=J();t.type="auto_captured",t.name="log",e&&(t.content=JSON.stringify(e)),w("predem_log_event",t)},y=e=>{var t=J();t.type="auto_captured",t.name="crash",e&&(t.content=JSON.stringify(e)),w("predem_crash_event",t)},h=e=>{var t=J();t.type="auto_captured",t.name="auto_captured_transaction",e&&(t.content=JSON.stringify(e)),w("predem_transaction_event",t)},w=(e,t)=>{wx.getStorage({key:e,success:r=>{let o=r.data;o.push(JSON.stringify(t)),wx.setStorage({key:e,data:o})},fail:()=>{let r=[JSON.stringify(t)];wx.setStorage({key:e,data:r})}})},S=()=>{u||(u=!0,wx.getStorage({key:"predem_custom_event",success:function(e){j("custom-events",e.data,()=>{wx.removeStorage({key:"predem_custom_event"})})},complete:()=>{u=!1}}))},b=()=>{p||(p=!0,wx.getStorage({key:"predem_http_event",success:e=>{j("http-monitors",e.data,()=>{wx.removeStorage({key:"predem_http_event"})})},complete:()=>{p=!1}}))},k=()=>{l||(l=!0,wx.getStorage({key:"predem_transaction_event",success:e=>{j("transactions",e.data,()=>{wx.removeStorage({key:"predem_transaction_event"})})},complete:()=>{l=!1}}))},D=()=>{d||(d=!0,wx.getStorage({key:"predem_log_event",success:e=>{j("log-capture",e.data,e=>{wx.removeStorage({key:"predem_log_event"})})},complete:()=>{d=!1}}))},O=()=>{m||(m=!0,wx.getStorage({key:"predem_crash_event",success:e=>{j("crashes",e.data,e=>{wx.removeStorage({key:"predem_crash_event"})})},complete:()=>{m=!1}}))},j=(e,t,r,o)=>{let n=t.join("\n");wx.request({url:a+"/v2/"+s+"/"+e,data:n,method:"POST",success:e=>{e.statusCode>=200&&e.statusCode<300?r(e):o(e)},fail:o})};function T(e,t,r){e[t]?(e[g+t]=e[t],e[t]=((...o)=>{r.call(this,o,t),e[g+t].call(this,...o)})):e[t]=((...e)=>{r.call(this,...e,t)})}const J=()=>{const e=wx.getSystemInfoSync(),t=getCurrentPages();var r={time:Date.now(),sdk_version:"1.0.1",sdk_id:(()=>{let e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?r:3&r|8).toString(16)})})(),device_model:e.model,mini_program_type:"WeChat",mini_program_version:e.version,mini_program_sdk_version:e.SDKVersion};if(i&&(r.app_version=i),n&&(r.tag=n),0!=t.length){let e=t[t.length-1].route;e&&(r.path=e)}return r};e.exports={setOpenId:e=>{n=e||""},captureCustomEvent:(e,t)=>{((e,t)=>{var r=J();r.type="custom",r.name=e,t&&(r.content=JSON.stringify(t)),w("predem_custom_event",r)})(e,t)},request:e=>{var t={start_timestamp:Date.now()};if(e&&(e.method?t.method=e.method:t.method="GET",e.url)){let r=(e=>{var t="",r="";const o=e.split("//");var n;let a=(n=1===o.length?o[0]:o[1]).indexOf("/");return-1==a?t=n:(t=n.substring(0,a),r=n.substring(a,n.length)),{domain:t,path:r}})(e.url);r&&r.domain&&(t.domain=r.domain),r&&r.path&&(t.path=r.path)}var r=Object.assign({},e);T(r,"success",e=>{t.end_timestamp=Date.now(),t.status_code=e.statusCode,e.data&&(t.data_length=JSON.stringify(e.data).length),x(t)}),T(r,"fail",e=>{t.end_timestamp=Date.now(),t.network_error_msg=e.errMsg,x(t)}),wx.request(r)},captureError:e=>{e.stack&&(e=e.stack),y({crash_log_key:e})},transactionStart:e=>({start_time:(new Date).getTime(),transaction_name:e,complete:()=>{this.end_time=(new Date).getTime(),this.transaction_type=0,h(this)},cancelWithReason:e=>{this.end_time=(new Date).getTime(),this.transaction_type=1,this.reason=e,h(this)},failWithReason:e=>{this.end_time=(new Date).getTime(),this.transaction_type=2,this.reason=e,h(this)}})};const N=()=>{!0!==_&&(_=!0,void 0===c?wx.getStorage({key:"predem_app_config",success:function(e){void 0!==e.data&&void 0!==e.data.time&&void 0!==e.data.log_capture_enabled&&void 0!==e.data.crash_report_enabled&&new Date(Date.now).toLocaleDateString===new Date(e.data.time).toLocaleDateString?(c=e.data,_=!1):M(e=>{_=!1})},fail:function(){M(e=>{_=!1})}}):new Date(Date.now).toLocaleDateString!==new Date(c.time).toLocaleDateString?M(e=>{_=!1}):_=!1)},M=e=>{j("app-config",[JSON.stringify(J())],t=>{t.data&&void 0!==t.data.log_capture_enabled&&void 0!==t.data.crash_report_enabled&&((c=t.data).time=Date.now(),wx.setStorage({key:"predem_app_config",data:c})),e(t)},e)};24===o.appKey.length?0!=o.domain.length?(a=o.domain,s=o.appKey.substring(0,8),i=o.appVersion||"",(()=>{const e=["debug","info","warn","error","log"];for(const t of e)T(console,t,(...e)=>{(void 0===c||c.log_capture_enabled)&&v({level:t,message:JSON.stringify(e[0])})})})(),setTimeout(()=>{let t=getApp();t.dem=e.exports;var r=t.onError;let o=e=>{(void 0===c||c.crash_report_enabled)&&y({crash_log_key:e})};var n=o;r&&(n=(e=>{r(e),o(e)})),App({onError:n,onShow:N})},0),N(),setTimeout(f,1e4)):console.error("请正确设置 domain，不能为空"):console.error("请正确设置 appKey，长度为 24")},function(t,r){t.exports=e}])});